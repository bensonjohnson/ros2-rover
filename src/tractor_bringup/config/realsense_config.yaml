# Intel RealSense D435i Optimized Configuration for RTAB-Map
# Resolution: 424x240@15Hz (minimum supported framerate, reduced bandwidth)
# Optimized for autonomous navigation with point cloud enabled

/camera/camera:
  ros__parameters:
    # Device configuration
    camera_name: "camera"
    camera_namespace: "camera"

    # Stream profiles - minimal bandwidth configuration
    depth_module:
      depth_profile: "640x480x6"
      enable_auto_exposure: true
      auto_exposure_limit: 100000
      emitter_enabled: 0  # Disabled to reduce USB bandwidth (0=off, 1=on, 2=auto)
      laser_power: 150.0
      accuracy: 2

    rgb_camera:
      color_profile: "640x480x6"
      enable_auto_exposure: true
      auto_exposure_limit: 100000
      brightness: 0
      contrast: 50
      gamma: 300
      saturation: 64

    # Enable required streams
    enable_color: true
    enable_depth: true
    enable_sync: true

    # Pointcloud configuration - CRITICAL for RTAB-Map
    pointcloud:
      enable: true
      stream_filter: 2  # Use color stream for texture
      allow_no_texture_points: false
      ordered_pc: false

    # Depth alignment - critical for proper pointcloud
    align_depth:
      enable: true

    # Disable camera IMU to save bandwidth (we use LSM9DS1 IMU)
    enable_imu: false
    enable_gyro: false
    enable_accel: false
    enable_infra1: false
    enable_infra2: false

    # Filters - enable decimation to reduce point count
    decimation_filter:
      enable: true
      filter_magnitude: 3  # Reduce point cloud density for performance

    temporal_filter:
      enable: true
      smooth_alpha: 0.4
      smooth_delta: 20
      persistence_control: 3

    spatial_filter:
      enable: true
      smooth_alpha: 0.5
      smooth_delta: 20
      magnitude: 2
      holes_fill: 0

    hole_filling_filter:
      enable: true
      holes_fill: 1

    disparity_filter:
      enable: false

    # TF and performance settings
    publish_tf: true
    tf_publish_rate: 15.0

    # Clip distance for outdoor/indoor use
    clip_distance: 6.0

    # USB stability
    initial_reset: true
    wait_for_device_timeout: 10.0
    reconnect_timeout: 5.0
